<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario PEPS Interactivo</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f9f9f9; }
    h2 { margin-bottom: 10px; }
    table { border-collapse: collapse; width: 100%; background: white; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
    th { background-color: #f0f0f0; }
    input[type="number"], input[type="date"], select { width: 100%; box-sizing: border-box; padding: 5px; }
    button { margin-top: 10px; padding: 8px 12px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Inventario PEPS</h2>
  <table id="tablaPEPS">
    <thead>
      <tr>
        <th>Fecha</th>
        <th>Movimiento</th>
        <th>Cantidad</th>
        <th>Precio Unitario</th>
        <th>Total</th>
        <th>Existencia</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><input type="date"></td>
        <td>
          <select>
            <option value="Compra">Compra</option>
            <option value="Venta">Venta</option>
          </select>
        </td>
        <td><input type="number" class="cantidad"></td>
        <td><input type="number" class="precio"></td>
        <td><input type="number" class="total" readonly></td>
        <td><input type="number" class="existencia" readonly></td>
      </tr>
    </tbody>
  </table>
  <button onclick="agregarFilaPEPS()">+ AÃ±adir fila</button>

  <script>
    function agregarFilaPEPS() {
      const tabla = document.querySelector("#tablaPEPS tbody");
      const fila = document.createElement("tr");
      fila.innerHTML = `
        <td><input type="date"></td>
        <td>
          <select>
            <option value="Compra">Compra</option>
            <option value="Venta">Venta</option>
          </select>
        </td>
        <td><input type="number" class="cantidad"></td>
        <td><input type="number" class="precio"></td>
        <td><input type="number" class="total" readonly></td>
        <td><input type="number" class="existencia" readonly></td>
      `;
      tabla.appendChild(fila);
      aplicarCalculos();
    }

    function aplicarCalculos() {
      document.querySelectorAll("#tablaPEPS tbody tr").forEach((row, i, arr) => {
        const cantidad = row.querySelector(".cantidad");
        const precio = row.querySelector(".precio");
        const total = row.querySelector(".total");
        const existencia = row.querySelector(".existencia");
        const movimiento = row.querySelector("select");

        cantidad.addEventListener("input", actualizar);
        precio.addEventListener("input", actualizar);
        movimiento.addEventListener("change", actualizar);

        function actualizar() {
          const cant = parseFloat(cantidad.value) || 0;
          const pu = parseFloat(precio.value) || 0;
          total.value = (cant * pu).toFixed(2);

          let anterior = i > 0 ? parseFloat(arr[i-1].querySelector(".existencia").value) || 0 : 0;
          existencia.value = movimiento.value === "Compra" ? anterior + cant : anterior - cant;
        }
      });
    }

    aplicarCalculos();
  </script>
</body>
</html>
