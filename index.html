<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Cardex - Valoración Ponderada</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f0f0f0;
    }
    nav {
      background-color: #004d73;
      color: white;
      display: flex;
      justify-content: space-around;
      padding: 15px 0;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }
    section {
      display: none;
      padding: 20px;
    }
    section.active {
      display: block;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: white;
    }
    th, td {
      border: 1px solid #999;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #d9d9d9;
    }
    input, select {
      margin: 5px;
      padding: 5px;
    }
    button {
      padding: 10px 20px;
      margin: 10px 0;
      background-color: #007acc;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
  </style>
</head>
<body>
  <nav>
    <a href="#" onclick="mostrar('operacion')">Ingresar Operación</a>
    <a href="#" onclick="mostrar('valoracion')">Valoración Ponderada</a>
    <a href="#" onclick="mostrar('stock')">Stock de Mercancía</a>
    <a href="#" onclick="mostrar('utilidad')">Utilidad Bruta</a>
  </nav>

  <section id="operacion" class="active">
    <h2>Ingresar Operación</h2>
    <form id="form">
      <input type="text" id="fecha" placeholder="Fecha">
      <select id="tipo">
        <option>Inventario inicial</option>
        <option>Compra</option>
        <option>Venta</option>
        <option>Devolución sobre venta</option>
        <option>Devolución sobre compra</option>
      </select>
      <input type="text" id="descripcion" placeholder="Descripción">
      <input type="number" id="cantidad" placeholder="Cantidad">
      <input type="number" id="precio" placeholder="Precio Unitario">
      <button type="submit">Agregar</button>
    </form>
  </section>

  <section id="valoracion">
    <h2>Tabla de Valoración Ponderada</h2>
    <table id="tabla">
      <thead>
        <tr>
          <th>Fecha</th><th>Tipo</th><th>Descripción</th><th>Cantidad</th><th>C.U</th><th>Total</th><th>Existencias</th><th>Valor Final</th><th>Costo Promedio</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </section>

  <section id="stock">
    <h2>Stock de Mercancía</h2>
    <p id="stockInfo">No hay datos aún.</p>
  </section>

  <section id="utilidad">
    <h2>Utilidad Bruta</h2>
    <p id="utilidadInfo">No hay datos aún.</p>
  </section>

  <script>
    let existencias = 0;
    let valorFinal = 0;
    let ventasTotales = 0;
    let costoDeVentas = 0;

    const form = document.getElementById('form');
    const tabla = document.querySelector('#tabla tbody');

    form.addEventListener('submit', e => {
      e.preventDefault();

      const fecha = document.getElementById('fecha').value;
      const tipo = document.getElementById('tipo').value;
      const descripcion = document.getElementById('descripcion').value;
      const cantidad = parseFloat(document.getElementById('cantidad').value);
      const precio = parseFloat(document.getElementById('precio').value);

      const esEntrada = tipo === "Compra" || tipo === "Inventario inicial" || tipo === "Devolución sobre venta";
      const esSalida = tipo === "Venta" || tipo === "Devolución sobre compra";

      let total = 0;
      if (esEntrada) {
        total = cantidad * precio;
        existencias += cantidad;
        valorFinal += total;
      } else if (esSalida) {
        const costoPromedio = valorFinal / existencias;
        total = cantidad * costoPromedio;
        ventasTotales += (tipo === "Venta") ? cantidad * precio : 0;
        costoDeVentas += total;
        existencias -= cantidad;
        valorFinal -= total;
      }

      const costoPromedioFinal = valorFinal / existencias || 0;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${fecha}</td><td>${tipo}</td><td>${descripcion}</td><td>${cantidad}</td><td>$${precio.toFixed(2)}</td><td>$${total.toFixed(2)}</td><td>${existencias}</td><td>$${valorFinal.toFixed(2)}</td><td>$${costoPromedioFinal.toFixed(2)}</td>
      `;
      tabla.appendChild(row);

      document.getElementById('stockInfo').innerText = `Cantidad: ${existencias} unidades | Valor: $${valorFinal.toFixed(2)} | Promedio: $${costoPromedioFinal.toFixed(2)}`;
      document.getElementById('utilidadInfo').innerText = `Ventas netas: $${ventasTotales.toFixed(2)} | Costo de ventas: $${costoDeVentas.toFixed(2)} | Utilidad bruta: $${(ventasTotales - costoDeVentas).toFixed(2)}`;

      form.reset();
    });

    function mostrar(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
  </script>
</body>
</html>
